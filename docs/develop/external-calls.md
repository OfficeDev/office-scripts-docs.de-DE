---
title: Externe API-Anruf Unterstützung in Office-Skripts
description: Unterstützung und Anleitung zum Ausführen externer API-Aufrufe in einem Office Skripts.
ms.date: 05/17/2021
localization_priority: Normal
ms.openlocfilehash: fd6ba0c57bf4cabb2d07421355cacff373f6706c
ms.sourcegitcommit: 4687693f02fc90a57ba30c461f35046e02e6f5fb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/19/2021
ms.locfileid: "52545082"
---
# <a name="external-api-call-support-in-office-scripts"></a><span data-ttu-id="c5666-103">Externe API-Anruf Unterstützung in Office-Skripts</span><span class="sxs-lookup"><span data-stu-id="c5666-103">External API call support in Office Scripts</span></span>

<span data-ttu-id="c5666-104">Skriptautoren sollten während der Vorschauphase der Plattform kein konsistentes Verhalten bei der Verwendung externer [APIs](https://developer.mozilla.org/docs/Web/API) erwarten.</span><span class="sxs-lookup"><span data-stu-id="c5666-104">Script authors shouldn't expect consistent behavior when using [external APIs](https://developer.mozilla.org/docs/Web/API) during the platform's preview phase.</span></span> <span data-ttu-id="c5666-105">Verlassen Sie sich daher bei kritischen Skriptszenarien nicht auf externe APIs.</span><span class="sxs-lookup"><span data-stu-id="c5666-105">As such, do not rely on external APIs for critical script scenarios.</span></span>

<span data-ttu-id="c5666-106">Aufrufe an externe APIs können nur über die Excel und nicht über Power Automate unter normalen [Umständen vorgenommen werden.](#external-calls-from-power-automate)</span><span class="sxs-lookup"><span data-stu-id="c5666-106">Calls to external APIs can be only be made through the Excel application, not through Power Automate [under normal circumstances](#external-calls-from-power-automate).</span></span>

> [!CAUTION]
> <span data-ttu-id="c5666-107">Externe Anrufe können dazu führen, dass vertrauliche Daten unerwünschten Endpunkten ausgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="c5666-107">External calls may result in sensitive data being exposed to undesirable endpoints.</span></span> <span data-ttu-id="c5666-108">Ihr Administrator kann einen Firewallschutz gegen solche Anrufe einrichten.</span><span class="sxs-lookup"><span data-stu-id="c5666-108">Your admin can establish firewall protection against such calls.</span></span>

## <a name="configure-your-script-for-external-calls"></a><span data-ttu-id="c5666-109">Konfigurieren des Skripts für externe Anrufe</span><span class="sxs-lookup"><span data-stu-id="c5666-109">Configure your script for external calls</span></span>

<span data-ttu-id="c5666-110">Externe Aufrufe [sind asynchron](https://developer.mozilla.org/docs/Learn/JavaScript/Asynchronous/Async_await) und erfordern, dass Ihr Skript als gekennzeichnet `async` ist.</span><span class="sxs-lookup"><span data-stu-id="c5666-110">External calls are [asynchronous](https://developer.mozilla.org/docs/Learn/JavaScript/Asynchronous/Async_await) and require that your script is marked as `async`.</span></span> <span data-ttu-id="c5666-111">Fügen Sie `async` das Präfix zu Ihrer Funktion `main` hinzu, und geben Sie ein `Promise` zurück, wie hier gezeigt:</span><span class="sxs-lookup"><span data-stu-id="c5666-111">Add the `async` prefix to your `main` function and have it return a `Promise`, as shown here:</span></span>

```typescript
async function main(workbook: ExcelScript.Workbook) : Promise <void>
```

> [!NOTE]
> <span data-ttu-id="c5666-112">Skripts, die andere Informationen zurückgeben, können einen `Promise` dieser Typen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="c5666-112">Scripts that return other information can return a `Promise` of that type.</span></span> <span data-ttu-id="c5666-113">Wenn Ihr Skript z. B. ein Objekt zurückgeben muss, würde die `Employee` Rückgabesignatur `: Promise <Employee>`</span><span class="sxs-lookup"><span data-stu-id="c5666-113">For example, if your script needs to return an `Employee` object, the return signature would be `: Promise <Employee>`</span></span>

<span data-ttu-id="c5666-114">Sie müssen die Schnittstellen des externen Diensts erlernen, um Anrufe an diesen Dienst zu nehmen.</span><span class="sxs-lookup"><span data-stu-id="c5666-114">You'll need to learn the external service's interfaces to make calls to that service.</span></span> <span data-ttu-id="c5666-115">Wenn Sie oder `fetch` [REST-APIs verwenden,](https://wikipedia.org/wiki/Representational_state_transfer)müssen Sie die JSON-Struktur der zurückgegebenen Daten ermitteln.</span><span class="sxs-lookup"><span data-stu-id="c5666-115">If you are using `fetch` or [REST APIs](https://wikipedia.org/wiki/Representational_state_transfer), you need to determine the JSON structure of the returned data.</span></span> <span data-ttu-id="c5666-116">Für Eingaben und Ausgaben ihres Skripts sollten Sie eine so erstellen, dass sie den `interface` erforderlichen JSON-Strukturen entsprechen.</span><span class="sxs-lookup"><span data-stu-id="c5666-116">For both input to and output from your script, consider making an `interface` to match the needed JSON structures.</span></span> <span data-ttu-id="c5666-117">Dies gibt dem Skript mehr Typsicherheit.</span><span class="sxs-lookup"><span data-stu-id="c5666-117">This gives the script more type safety.</span></span> <span data-ttu-id="c5666-118">Ein Beispiel dafür finden Sie unter [Using fetch from Office Scripts](../resources/samples/external-fetch-calls.md).</span><span class="sxs-lookup"><span data-stu-id="c5666-118">You can see an example of this in [Using fetch from Office Scripts](../resources/samples/external-fetch-calls.md).</span></span>

### <a name="limitations-with-external-calls-from-office-scripts"></a><span data-ttu-id="c5666-119">Einschränkungen bei externen Aufrufen von Office Skripts</span><span class="sxs-lookup"><span data-stu-id="c5666-119">Limitations with external calls from Office Scripts</span></span>

* <span data-ttu-id="c5666-120">Es gibt keine Möglichkeit zum Anmelden oder Verwenden von OAuth2-Authentifizierungsflüssen.</span><span class="sxs-lookup"><span data-stu-id="c5666-120">There is no way to sign in or use OAuth2 type of authentication flows.</span></span> <span data-ttu-id="c5666-121">Alle Schlüssel und Anmeldeinformationen müssen hartcodiert sein (oder aus einer anderen Quelle gelesen werden).</span><span class="sxs-lookup"><span data-stu-id="c5666-121">All keys and credentials have to be hardcoded (or read from another source).</span></span>
* <span data-ttu-id="c5666-122">Es gibt keine Infrastruktur zum Speichern von API-Anmeldeinformationen und -Schlüsseln.</span><span class="sxs-lookup"><span data-stu-id="c5666-122">There is no infrastructure to store API credentials and keys.</span></span> <span data-ttu-id="c5666-123">Dies muss vom Benutzer verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="c5666-123">This will have to be managed by the user.</span></span>
* <span data-ttu-id="c5666-124">Dokumentcookies `localStorage` und Objekte werden nicht `sessionStorage` unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c5666-124">Document cookies, `localStorage`, and `sessionStorage` objects are not supported.</span></span> 
* <span data-ttu-id="c5666-125">Externe Aufrufe können dazu führen, dass vertrauliche Daten unerwünschten Endpunkten ausgesetzt werden oder externe Daten in interne Arbeitsmappen gebracht werden.</span><span class="sxs-lookup"><span data-stu-id="c5666-125">External calls may result in sensitive data being exposed to undesirable endpoints, or external data to be brought into internal workbooks.</span></span> <span data-ttu-id="c5666-126">Ihr Administrator kann einen Firewallschutz gegen solche Anrufe einrichten.</span><span class="sxs-lookup"><span data-stu-id="c5666-126">Your admin can establish firewall protection against such calls.</span></span> <span data-ttu-id="c5666-127">Überprüfen Sie unbedingt lokale Richtlinien, bevor Sie sich auf externe Anrufe verlassen.</span><span class="sxs-lookup"><span data-stu-id="c5666-127">Be sure to check with local policies prior to relying on external calls.</span></span>
* <span data-ttu-id="c5666-128">Achten Sie darauf, den Datendurchsatz zu überprüfen, bevor Sie eine Abhängigkeit verwenden.</span><span class="sxs-lookup"><span data-stu-id="c5666-128">Be sure to check the amount of data throughput prior to taking a dependency.</span></span> <span data-ttu-id="c5666-129">Beispielsweise ist das Herunterziehen des gesamten externen Datasets möglicherweise nicht die beste Option, und stattdessen sollte die Paginierung verwendet werden, um Daten in Blöcken zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="c5666-129">For instance, pulling down the entire external dataset may not be the best option and instead pagination should be used to get data in chunks.</span></span>

## <a name="retrieve-information-with-fetch"></a><span data-ttu-id="c5666-130">Abrufen von Informationen mit `fetch`</span><span class="sxs-lookup"><span data-stu-id="c5666-130">Retrieve information with `fetch`</span></span>

<span data-ttu-id="c5666-131">Die [Fetch-API](https://developer.mozilla.org/docs/Web/API/Fetch_API) ruft Informationen von externen Diensten ab.</span><span class="sxs-lookup"><span data-stu-id="c5666-131">The [fetch API](https://developer.mozilla.org/docs/Web/API/Fetch_API) retrieves information from external services.</span></span> <span data-ttu-id="c5666-132">Es handelt sich `async` um eine API, daher müssen Sie die Signatur `main` Ihres Skripts anpassen.</span><span class="sxs-lookup"><span data-stu-id="c5666-132">It is an `async` API, so you need to adjust the `main` signature of your script.</span></span> <span data-ttu-id="c5666-133">Erstellen Sie `main` die `async` Funktion, und lassen Sie sie einen `Promise<void>` zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="c5666-133">Make the `main` function `async` and have it return a `Promise<void>`.</span></span> <span data-ttu-id="c5666-134">Sie sollten auch den Anruf und den `await` `fetch` Abruf `json` sicherstellen.</span><span class="sxs-lookup"><span data-stu-id="c5666-134">You should also be sure to `await` the `fetch` call and `json` retrieval.</span></span> <span data-ttu-id="c5666-135">Dadurch wird sichergestellt, dass diese Vorgänge abgeschlossen sind, bevor das Skript endet.</span><span class="sxs-lookup"><span data-stu-id="c5666-135">This ensures those operations complete before the script ends.</span></span>

<span data-ttu-id="c5666-136">Alle von abgerufenen `fetch` JSON-Daten müssen mit einer im Skript definierten Schnittstelle übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="c5666-136">Any JSON data retrieved by `fetch` must match an interface defined in the script.</span></span> <span data-ttu-id="c5666-137">Der zurückgegebene Wert muss einem bestimmten Typ zugewiesen werden, [da Office Skripts den Typ nicht `any` unterstützen.](typescript-restrictions.md#no-any-type-in-office-scripts)</span><span class="sxs-lookup"><span data-stu-id="c5666-137">The returned value must be assigned to a specific type because [Office Scripts do not support the `any` type](typescript-restrictions.md#no-any-type-in-office-scripts).</span></span> <span data-ttu-id="c5666-138">Informationen zu den Namen und Typen der zurückgegebenen Eigenschaften finden Sie in der Dokumentation für Ihren Dienst.</span><span class="sxs-lookup"><span data-stu-id="c5666-138">You should refer to the documentation for your service to see what the names and types of the returned properties are.</span></span> <span data-ttu-id="c5666-139">Fügen Sie dann die übereinstimmende Schnittstelle oder Schnittstellen zu Ihrem Skript hinzu.</span><span class="sxs-lookup"><span data-stu-id="c5666-139">Then, add the matching interface or interfaces to your script.</span></span>

<span data-ttu-id="c5666-140">Das folgende Skript `fetch` verwendet, um JSON-Daten vom Testserver in der angegebenen URL abzurufen.</span><span class="sxs-lookup"><span data-stu-id="c5666-140">The following script uses `fetch` to retrieve JSON data from the test server in the given URL.</span></span> <span data-ttu-id="c5666-141">Notieren Sie `JSONData` sich die Schnittstelle, um die Daten als übereinstimmenden Typ zu speichern.</span><span class="sxs-lookup"><span data-stu-id="c5666-141">Note the `JSONData` interface to store the data as a matching type.</span></span>

```TypeScript
async function main(workbook: ExcelScript.Workbook): Promise<void> {
  // Retrieve sample JSON data from a test server.
  let fetchResult = await fetch('https://jsonplaceholder.typicode.com/todos/1');

  // Convert the returned data to the expected JSON structure.
  let json : JSONData = await fetchResult.json();

  // Display the content in a readable format.
  console.log(JSON.stringify(json));
}

/**
 * An interface that matches the returned JSON structure.
 * The property names match exactly.
 */
interface JSONData {
  userId: number;
  id: number;
  title: string;
  completed: boolean;
}
```

### <a name="other-fetch-samples"></a><span data-ttu-id="c5666-142">Weitere `fetch` Beispiele</span><span class="sxs-lookup"><span data-stu-id="c5666-142">Other `fetch` samples</span></span>

* <span data-ttu-id="c5666-143">Das [Beispiel Externe Abrufaufrufe in Office Skripts](../resources/samples/external-fetch-calls.md) verwenden zeigt, wie Sie grundlegende Informationen über die GitHub eines Benutzers abrufen.</span><span class="sxs-lookup"><span data-stu-id="c5666-143">The [Use external fetch calls in Office Scripts](../resources/samples/external-fetch-calls.md) sample shows how to get basic information about a user's GitHub repositories.</span></span>
* <span data-ttu-id="c5666-144">Das [beispielszenario Office Scripts: Graph](../resources/scenarios/noaa-data-fetch.md) Daten auf Wasserebene aus NOAA veranschaulicht den Abrufbefehl, der zum Abrufen von Datensätzen aus der Flut- und Currents-Datenbank der National Oceanic and Atmospheric Administration verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c5666-144">The [Office Scripts sample scenario: Graph water-level data from NOAA](../resources/scenarios/noaa-data-fetch.md) demonstrates the fetch command being used to retrieve records from the National Oceanic and Atmospheric Administration's Tides and Currents database.</span></span>

## <a name="external-calls-from-power-automate"></a><span data-ttu-id="c5666-145">Externe Anrufe von Power Automate</span><span class="sxs-lookup"><span data-stu-id="c5666-145">External calls from Power Automate</span></span>

<span data-ttu-id="c5666-146">Ein externer API-Aufruf schlägt fehl, wenn ein Skript mit einem Power Automate.</span><span class="sxs-lookup"><span data-stu-id="c5666-146">Any external API call fails when a script is run with Power Automate.</span></span> <span data-ttu-id="c5666-147">Dies ist ein Verhaltensunterschied zwischen dem Ausführen eines Skripts über die Excel und Power Automate.</span><span class="sxs-lookup"><span data-stu-id="c5666-147">This is a behavioral difference between running a script through the Excel application and through Power Automate.</span></span> <span data-ttu-id="c5666-148">Überprüfen Sie ihre Skripts auf solche Verweise, bevor Sie sie in einen Fluss erstellen.</span><span class="sxs-lookup"><span data-stu-id="c5666-148">Be sure to check your scripts for such references before building them into a flow.</span></span>

<span data-ttu-id="c5666-149">Sie müssen HTTP mit [Azure AD](/connectors/webcontents/) oder andere gleichwertige Aktionen verwenden, um Daten von einem externen Dienst zu ziehen oder an einen externen Dienst zu pushen.</span><span class="sxs-lookup"><span data-stu-id="c5666-149">You'll have to use [HTTP with Azure AD](/connectors/webcontents/) or other equivalent actions to pull data from or push it to an external service.</span></span>

> [!WARNING]
> <span data-ttu-id="c5666-150">Externe Anrufe, die über den Power Automate [Excel Onlineconnector](/connectors/excelonlinebusiness) vorgenommen werden, führen zu einem Fehler, um vorhandene Richtlinien zur Verhinderung von Datenverlust zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="c5666-150">External calls made through the Power Automate [Excel Online connector](/connectors/excelonlinebusiness) fail in order to help uphold existing data loss prevention policies.</span></span> <span data-ttu-id="c5666-151">Skripts, die durch Power Automate ausgeführt werden, werden jedoch außerhalb Ihrer Organisation und außerhalb der Firewalls Ihrer Organisation ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c5666-151">However, scripts that are run through Power Automate are done so outside of your organization, and outside of your organization's firewalls.</span></span> <span data-ttu-id="c5666-152">Für zusätzlichen Schutz vor böswilligen Benutzern in dieser externen Umgebung kann Ihr Administrator die Verwendung von skripts Office steuern.</span><span class="sxs-lookup"><span data-stu-id="c5666-152">For additional protection from malicious users in this external environment, your admin can control the use of Office Scripts.</span></span> <span data-ttu-id="c5666-153">Ihr Administrator kann entweder den Excel Onlineconnector in Power Automate deaktivieren oder Office Skripts für Excel im Web über die Office Scripts-Administratorsteuerelemente [deaktivieren.](/microsoft-365/admin/manage/manage-office-scripts-settings)</span><span class="sxs-lookup"><span data-stu-id="c5666-153">Your admin can either disable the Excel Online connector in Power Automate or turn off Office Scripts for Excel on the web through the [Office Scripts administrator controls](/microsoft-365/admin/manage/manage-office-scripts-settings).</span></span>

## <a name="see-also"></a><span data-ttu-id="c5666-154">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="c5666-154">See also</span></span>

* [<span data-ttu-id="c5666-155">Verwenden von integrierten JavaScript-Objekten in Office-Skripts</span><span class="sxs-lookup"><span data-stu-id="c5666-155">Using built-in JavaScript objects in Office Scripts</span></span>](javascript-objects.md)
* [<span data-ttu-id="c5666-156">Verwenden von externen Abrufanrufen in Office-Skripts</span><span class="sxs-lookup"><span data-stu-id="c5666-156">Use external fetch calls in Office Scripts</span></span>](../resources/samples/external-fetch-calls.md)
* [<span data-ttu-id="c5666-157">Office Beispielszenario für Skripts: Graph daten auf Wasserebene aus NOAA</span><span class="sxs-lookup"><span data-stu-id="c5666-157">Office Scripts sample scenario: Graph water-level data from NOAA</span></span>](../resources/scenarios/noaa-data-fetch.md)
